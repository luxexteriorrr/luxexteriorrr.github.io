<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PoseNet Poster Interaction</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      overflow: hidden;
    }

    #status {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 1.5rem;
      background: rgba(255, 255, 255, 0.8);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      z-index: 2;
    }

    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }
  </style>
</head>
<body>
  <div id="status">Loading PoseNet...</div>

  <!-- Load libraries -->
  <script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>

  <script>
    let video;
    let poseNet;
    let poses = [];
    let statusText;

    function setup() {
      createCanvas(640, 480);
      video = createCapture(VIDEO);
      video.size(width, height);
      video.hide();

      // Load PoseNet and set up results listener
      poseNet = ml5.poseNet(video, { detectionType: 'single' }, modelReady);
      poseNet.on("pose", (results) => {
        poses = results;
      });

      // Use native JS for DOM element
      statusText = document.getElementById("status");
    }

    function modelReady() {
      console.log("PoseNet model loaded.");
      statusText.innerText = "PoseNet ready";
    }

    function draw() {
      image(video, 0, 0, width, height);

      for (let i = 0; i < poses.length; i++) {
        let pose = poses[i].pose;

        for (let j = 0; j < pose.keypoints.length; j++) {
          let keypoint = pose.keypoints[j];
          if (keypoint.score > 0.3) {
            fill(0, 255, 0);
            noStroke();
            ellipse(keypoint.position.x, keypoint.position.y, 10, 10);
          }
        }

        // Example: Detect if user is leaning in (nose near bottom of screen)
        const nose = pose.keypoints.find(k => k.part === "nose");
        if (nose && nose.score > 0.5 && nose.position.y > height - 100) {
          statusText.innerText = "User leaning in ðŸ‘€";
        }
      }
    }
  </script>
</body>
</html>
